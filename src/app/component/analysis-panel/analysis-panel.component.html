<div id='analysisWrapper'>

  <!-- 
    //Param 1: analysis: "force","stress","kinematic"

    //Param 2: analysisType: IF analysis == force: "statics","dynamic"
    //Param 2: analysisType: IF analysis == kinematic: "loop","ic"

    //Param 3: mechProp: IF analysis == force: "Input Torque","Joint Forces"
    //Param 3: mechProp: IF analysis == kinematic: "Linear Joint Pos","Linear Joint Vel","Linear Joint Acc",
    //"Linear Link's CoM Pos","Linear Link's CoM Vel","Linear Link's CoM Acc",
    //"Angular Link Pos","Angular Link Vel",Angular Link Acc"

    //Param 4: mechPart: If Joint 'a','b','c'... If Link 'ab','bc','cd'... 
  -->

  <panel-section-collapsible
    [warning]='true'
    [expanded]='false'
    id='placeholderContainer'
    *ngIf='!this.mechanismService.oneValidMechanismExists()'
  >
    <title-block alwaysShown icon='expand_more'>Interactive Help</title-block>
    <subtitle-block alwaysShown>This linkage is not valid and cannot be analyzed. Make sure all requirements are met:
    </subtitle-block>
    <mat-list class='example-list-wrapping'>
      <mat-list-item lines='3'>
        <span matListItemTitle>Must have one input</span>
        <span>Mechanisms should have 1 and only one joint defined as a input.</span>
      </mat-list-item>
      <mat-list-item lines='2'>
        <span matListItemTitle>At least one joint is grounded</span>
        <span>An input joint doubles as a ground joint.</span>
      </mat-list-item>
      <mat-list-item lines='3'>
        <span matListItemTitle>No orphaned joints</span>
        <span>
          Joints that are not a part of any link are orphaned. Remove or connect
          orphaned joints.
        </span>
      </mat-list-item>
      <mat-list-item lines='3'>
        <span matListItemTitle>No free floating links</span>
        <span>
          Links that are not part of a grounded joint are free floating. Remove or
          connect free floating links.
        </span>
      </mat-list-item>
      <mat-list-item lines='3'>
        <span matListItemTitle>Degress of freedom must be one</span>
        <span>DOF = 3*(#_of_Links-1) - 2*(#_of_joints). Count both revolute joints and slider joints.</span>
      </mat-list-item>
      <mat-list-item lines='3'>
        <span matListItemTitle>Welded links count as one link</span>
        <span>
          If two or more links are welded together at a joint they should only be counted as 1 link.
        </span>
      </mat-list-item>
    </mat-list>
  </panel-section-collapsible>

  <!-- Valid Mech but Nothing Selected -->

  <panel-section-collapsible
    [warning]='true'
    [expanded]='false'
    id='placeholderContainer'
    *ngIf="this.activeSrv.objType == 'Grid' && this.mechanismService.oneValidMechanismExists()"
  >
    <title-block alwaysShown icon='expand_more'>Interactive Help</title-block>
    <subtitle-block alwaysShown>Select a part of the linkage to analyze it.</subtitle-block>
    <img src='assets/gifs/Click.gif' />
  </panel-section-collapsible>

  <!-- Joint Kinematics-->
  <panel-section-collapsible
    id='analysis-panel'
    *ngIf="validMechanisms() && this.activeSrv.objType == 'Joint'"
    [expanded]="graphExpanded['JKineAna']"
    (opened)="graphExpanded['JKineAna'] = true"
    (closed)="graphExpanded['JKineAna'] = false"
  >
    <title-block alwaysShown icon='expand_less'
                 description='The input speed is currently set to {{settingsService.inputSpeed.value.toFixed(2)}} RPM in
      the {{settingsService.isInputCW ? "clockwise" : "counter-clockwise"}} direction. This can be changed in the
    settings panel.'>
      Kinematic Analysis for Joint
      {{customIDService.getVisualID(this.activeSrv.selectedJoint.id)}}
    </title-block>

    <mat-expansion-panel
      [expanded]="graphExpanded['JPos']"
      (opened)="graphExpanded['JPos'] = true"
      (closed)="graphExpanded['Jpos'] = false"
    >
      <mat-expansion-panel-header>
        <mat-panel-title>
          Position of Joint {{customIDService.getVisualID(this.activeSrv.selectedJoint.id)}}
        </mat-panel-title>
        <mat-panel-description>
          <mat-icon
            matTooltip='The X and Y position of the selected joint graphed over time'
            [matTooltipShowDelay]='1000'
            id='graph-help'
          >help_outline
          </mat-icon
          >
        </mat-panel-description>
      </mat-expansion-panel-header>
      <app-analysis-graph
        analysis='kinematic'
        analysisType='loop'
        mechProp='Linear Joint Pos'
        mechPart='{{ this.activeSrv.selectedJoint.id }}'
      ></app-analysis-graph>
    </mat-expansion-panel>

    <mat-expansion-panel
      [expanded]="graphExpanded['JVel']"
      (opened)="graphExpanded['JVel'] = true"
      (closed)="graphExpanded['JVel'] = false"
    >
      <mat-expansion-panel-header>
        <mat-panel-title>
          Velocity of Joint {{customIDService.getVisualID(this.activeSrv.selectedJoint.id)}}
        </mat-panel-title>
        <mat-panel-description>
          <mat-icon
            matTooltip='The velocity of the selected joint graphed'
            [matTooltipShowDelay]='1000'
            id='graph-help'
          >help_outline
          </mat-icon
          >
        </mat-panel-description>
      </mat-expansion-panel-header>
      <app-analysis-graph
        analysis='kinematic'
        analysisType='loop'
        mechProp='Linear Joint Vel'
        mechPart='{{ this.activeSrv.selectedJoint.id }}'
      ></app-analysis-graph>
    </mat-expansion-panel>

    <mat-expansion-panel
      [expanded]="graphExpanded['JAcc']"
      (opened)="graphExpanded['JAcc'] = true"
      (closed)="graphExpanded['JAcc'] = false"
    >
      <mat-expansion-panel-header>
        <mat-panel-title>
          Acceleration of Joint {{customIDService.getVisualID(this.activeSrv.selectedJoint.id)}}
        </mat-panel-title>
        <mat-panel-description>
          <mat-icon
            matTooltip='The acceleration of the selected joint graphed'
            [matTooltipShowDelay]='1000'
            id='graph-help'
          >help_outline
          </mat-icon
          >
        </mat-panel-description>
      </mat-expansion-panel-header>
      <app-analysis-graph
        analysis='kinematic'
        analysisType='loop'
        mechProp='Linear Joint Acc'
        mechPart='{{ this.activeSrv.selectedJoint.id }}'
      ></app-analysis-graph>
    </mat-expansion-panel>
  </panel-section-collapsible>

  <!-- Joint Forces-->
  <panel-section-collapsible
    [expanded]="graphExpanded['JForceAna']"
    (opened)="graphExpanded['JForceAna'] = true"
    (closed)="graphExpanded['JForceAna'] = false"
    id='analysis-panel'
    *ngIf="validMechanisms() && this.activeSrv.objType == 'Joint'"
  >
    <title-block alwaysShown icon='expand_less'>
      Force Analysis for Joint
      {{customIDService.getVisualID(this.activeSrv.selectedJoint.id)}}
    </title-block>

    <radio-block
      tooltip='Determines whether the force analysis is done at static equilibrium or under dynamics conditions. The input speed for the dynamic analysis is set in the settings panel.'
      option1='Static (Equilibrium)'
      option2='In-motion (Dynamic)'
      [formGroup]='this.inputSpeedFormGroup'
      _formControl='speed'
    >Input Speed
    </radio-block
    >

    <mat-expansion-panel
      [expanded]="graphExpanded['JForce']"
      (opened)="graphExpanded['JForce'] = true"
      (closed)="graphExpanded['JForce'] = false"
    >
      <mat-expansion-panel-header>
        <mat-panel-title>
          Force on Joint {{customIDService.getVisualID(this.activeSrv.selectedJoint.id)}}
        </mat-panel-title>
        <mat-panel-description>
          <mat-icon
            matTooltip='The force applied at the selected joint graphed over time'
            [matTooltipShowDelay]='1000'
            id='graph-help'
          >help_outline
          </mat-icon
          >
        </mat-panel-description>
      </mat-expansion-panel-header>
      <app-analysis-graph
        analysis='force'
        analysisType="{{ this.inputSpeedFormGroup.value.speed === 'One' ? 'dynamic' : 'static' }}"
        mechProp='Joint Forces'
        mechPart='{{ this.activeSrv.selectedJoint.id }}'
      ></app-analysis-graph>
    </mat-expansion-panel>

    <mat-expansion-panel
      *ngIf='this.activeSrv.selectedJoint.input'
      [expanded]="graphExpanded['JInputForce']"
      (opened)="graphExpanded['JInputForce'] = true"
      (closed)="graphExpanded['JInputForce'] = false"
    >
      <mat-expansion-panel-header>
        <mat-panel-title>
          Input Torque at Joint {{customIDService.getVisualID(this.activeSrv.selectedJoint.id)}}
        </mat-panel-title>
        <mat-panel-description>
          <mat-icon
            matTooltip='The toque applied to the mechanism by the input joint graphed over time. Only available if the selected joint is grounded and is an input.'
            [matTooltipShowDelay]='1000'
            id='graph-help'
          >help_outline
          </mat-icon
          >
        </mat-panel-description>
      </mat-expansion-panel-header>
      <app-analysis-graph
        analysis='force'
        analysisType="{{ this.inputSpeedFormGroup.value.speed === 'One' ? 'dynamic' : 'static' }}"
        mechProp='Input Torque'
        mechPart='{{ this.activeSrv.selectedJoint.id }}'
      ></app-analysis-graph>
    </mat-expansion-panel>
  </panel-section-collapsible>

  <!-- Link Kinematics-->
  <panel-section-collapsible
    [expanded]="graphExpanded['LKineAna']"
    (opened)="graphExpanded['LKineAna'] = true"
    (closed)="graphExpanded['LKineAna'] = false"
    id='analysis-panel'
    *ngIf="validMechanisms() && this.activeSrv.objType == 'Link'"
  >
    <title-block alwaysShown icon='expand_less'
                 description='The input speed is currently set to {{settingsService.inputSpeed.value.toFixed(2)}} RPM in
      the {{settingsService.isInputCW ? "clockwise" : "counter-clockwise"}} direction. This can be changed in the
    settings panel.'>
      Kinematic Analysis for Link {{customIDService.getVisualID(this.activeSrv.selectedLink.id)}}
    </title-block>

    <!-- <subtitle-block>Kinematics</subtitle-block> -->

    <!-- 
    //Param 1: analysis: "force","stress","kinematic"

    //Param 2: analysisType: IF analysis == force: "statics","dynamic"
    //Param 2: analysisType: IF analysis == kinematic: "loop","ic"

    //Param 3: mechProp: IF analysis == force: "Input Torque","Joint Forces"
    //Param 3: mechProp: IF analysis == kinematic: "Linear Joint Pos","Linear Joint Vel","Linear Joint Acc",
    //"Linear Link's CoM Pos","Linear Link's CoM Vel","Linear Link's CoM Acc",
    //"Angular Link Pos","Angular Link Vel",Angular Link Acc"

    //Param 4: mechPart: If Joint 'a','b','c'... If Link 'ab','bc','cd'... 
  -->

    <mat-expansion-panel
      [expanded]="graphExpanded['LAng']"
      (opened)="graphExpanded['LAng'] = true"
      (closed)="graphExpanded['LAng'] = false"
    >
      <mat-expansion-panel-header>
        <mat-panel-title> Angle of
          Link {{customIDService.getVisualID(this.activeSrv.selectedLink.id)}} </mat-panel-title>
        <mat-panel-description>
          <mat-icon
            matTooltip='The angle of the selected above the horizontal of the link graphed over time'
            [matTooltipShowDelay]='1000'
            id='graph-help'
          >help_outline
          </mat-icon
          >
        </mat-panel-description>
      </mat-expansion-panel-header>
      <app-analysis-graph
        analysis='kinematic'
        analysisType='loop'
        mechProp='Angular Link Pos'
        mechPart='{{ this.activeSrv.selectedLink.id }}'
      ></app-analysis-graph>
    </mat-expansion-panel>

    <mat-expansion-panel
      [expanded]="graphExpanded['LAngVel']"
      (opened)="graphExpanded['LAngVel'] = true"
      (closed)="graphExpanded['LAngVel'] = false"
    >
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-panel-title>
            Angular Velocity of Link {{customIDService.getVisualID(this.activeSrv.selectedLink.id)}}
          </mat-panel-title>
        </mat-panel-title>
        <mat-panel-description>
          <mat-icon
            matTooltip='The angular velocity of the selected link graphed'
            [matTooltipShowDelay]='1000'
            id='graph-help'
          >help_outline
          </mat-icon
          >
        </mat-panel-description>
      </mat-expansion-panel-header>
      <app-analysis-graph
        analysis='kinematic'
        analysisType='loop'
        mechProp='Angular Link Vel'
        mechPart='{{ this.activeSrv.selectedLink.id }}'
      ></app-analysis-graph>
    </mat-expansion-panel>

    <mat-expansion-panel
      [expanded]="graphExpanded['LAngAcc']"
      (opened)="graphExpanded['LAngAcc'] = true"
      (closed)="graphExpanded['LAngAcc'] = false"
    >
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-panel-title>
            Angular Acceleration of Link {{customIDService.getVisualID(this.activeSrv.selectedLink.id)}}
          </mat-panel-title>
        </mat-panel-title>
        <mat-panel-description>
          <mat-icon
            matTooltip='The angular acceleration of the selected link graphed'
            [matTooltipShowDelay]='1000'
            id='graph-help'
          >help_outline
          </mat-icon
          >
        </mat-panel-description>
      </mat-expansion-panel-header>
      <app-analysis-graph
        analysis='kinematic'
        analysisType='loop'
        mechProp='Angular Link Acc'
        mechPart='{{ this.activeSrv.selectedLink.id }}'
      ></app-analysis-graph>
    </mat-expansion-panel>

    <subtitle-block style='margin-top: 20px'
    >Center of Mass (COM) of Link {{customIDService.getVisualID(this.activeSrv.selectedLink.id)}}</subtitle-block
    >

    <mat-expansion-panel
      [expanded]="graphExpanded['LPos']"
      (opened)="graphExpanded['LPos'] = true"
      (closed)="graphExpanded['LPos'] = false"
    >
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-panel-title>
            Position of Link {{customIDService.getVisualID(this.activeSrv.selectedLink.id)}}'s COM
          </mat-panel-title>
        </mat-panel-title>
        <mat-panel-description>
          <mat-icon
            matTooltip="The position of the selected link's COM graphed"
            [matTooltipShowDelay]='1000'
            id='graph-help'
          >help_outline
          </mat-icon
          >
        </mat-panel-description>
      </mat-expansion-panel-header>
      <app-analysis-graph
        analysis='kinematic'
        analysisType='loop'
        mechProp="Linear Link's CoM Pos"
        mechPart='{{ this.activeSrv.selectedLink.id }}'
      ></app-analysis-graph>
    </mat-expansion-panel>

    <mat-expansion-panel
      [expanded]="graphExpanded['LVel']"
      (opened)="graphExpanded['LVel'] = true"
      (closed)="graphExpanded['LVel'] = false"
    >
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-panel-title>
            Velocity of Link {{customIDService.getVisualID(this.activeSrv.selectedLink.id)}}'s COM
          </mat-panel-title>
        </mat-panel-title>
        <mat-panel-description>
          <mat-icon
            matTooltip="The velocity of the selected link's COM graphed"
            [matTooltipShowDelay]='1000'
            id='graph-help'
          >help_outline
          </mat-icon
          >
        </mat-panel-description>
      </mat-expansion-panel-header>
      <app-analysis-graph
        analysis='kinematic'
        analysisType='loop'
        mechProp="Linear Link's CoM Vel"
        mechPart='{{ this.activeSrv.selectedLink.id }}'
      ></app-analysis-graph>
    </mat-expansion-panel>

    <mat-expansion-panel
      [expanded]="graphExpanded['LAcc']"
      (opened)="graphExpanded['LAcc'] = true"
      (closed)="graphExpanded['LAcc'] = false"
    >
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-panel-title>
            Acceleration of Link {{customIDService.getVisualID(this.activeSrv.selectedLink.id)}}'s COM
          </mat-panel-title>
        </mat-panel-title>
        <mat-panel-description>
          <mat-icon
            matTooltip="The acceleration of the selected link's COM graphed"
            [matTooltipShowDelay]='1000'
            id='graph-help'
          >help_outline
          </mat-icon
          >
        </mat-panel-description>
      </mat-expansion-panel-header>
      <app-analysis-graph
        analysis='kinematic'
        analysisType='loop'
        mechProp="Linear Link's CoM Acc"
        mechPart='{{ this.activeSrv.selectedLink.id }}'
      ></app-analysis-graph>
    </mat-expansion-panel>
  </panel-section-collapsible>

  <!-- Link Forces-->
  <panel-section-collapsible
    [expanded]="graphExpanded['LForceAna']"
    (opened)="graphExpanded['LForceAna'] = true"
    (closed)="graphExpanded['LForceAna'] = false"
    id='analysis-panel'
    *ngIf="validMechanisms() && this.activeSrv.objType == 'Link'"
  >
    <title-block alwaysShown icon='expand_less'>
      Force Analysis for Link {{customIDService.getVisualID(this.activeSrv.selectedLink.id)}}
    </title-block>

    <radio-block
      tooltip='Determines whether the force analysis is done at static equilibrium or under dynamics conditions. For dynamics, the global animation speed can be used, or a custom speed can be set by selecting other.'
      option1='Global (20 rpm)'
      option2='Equilibrium (0 rpm)'
      option3='Other'
      [formGroup]='this.inputSpeedFormGroup'
      _formControl='speed'
    >Input Speed
    </radio-block
    >

    <mat-expansion-panel
      [expanded]="graphExpanded['LForce']"
      (opened)="graphExpanded['LForce'] = true"
      (closed)="graphExpanded['LForce'] = false"
    >
      <mat-expansion-panel-header>
        <mat-panel-title>
          Axial Force on Link {{customIDService.getVisualID(this.activeSrv.selectedLink.id)}}
        </mat-panel-title>
        <mat-panel-description>
          <mat-icon
            matTooltip="The axial force applied at the selected link's cross section graphed over time"
            [matTooltipShowDelay]='1000'
            id='graph-help'
          >help_outline
          </mat-icon
          >
        </mat-panel-description>
      </mat-expansion-panel-header>
      This feature is not available yet
      <!-- <app-analysis-graph
      analysis="force"
      analysisType="{{ this.inputSpeedFormGroup.value.speed === 'One' ? 'dynamic' : 'static' }}"
      mechProp="Joint Forces"
      mechPart="{{ this.activeSrv.Joint.id }}"
    ></app-analysis-graph> -->
    </mat-expansion-panel>

    <mat-expansion-panel
      [expanded]="graphExpanded['LStress']"
      (opened)="graphExpanded['LStress'] = true"
      (closed)="graphExpanded['LStress'] = false"
    >
      <mat-expansion-panel-header>
        <mat-panel-title>
          Axial Stress on Link {{customIDService.getVisualID(this.activeSrv.selectedLink.id)}}
        </mat-panel-title>
        <mat-panel-description>
          <mat-icon
            matTooltip="The axial stress applied at the selected link's minimum cross section graphed over time"
            [matTooltipShowDelay]='1000'
            id='graph-help'
          >help_outline
          </mat-icon
          >
        </mat-panel-description>
      </mat-expansion-panel-header>
      This feature is not available yet
      <!-- <app-analysis-graph
      analysis="force"
      analysisType="{{ this.inputSpeedFormGroup.value.speed === 'One' ? 'dynamic' : 'static' }}"
      mechProp="Input Torque"
      mechPart="{{ this.activeSrv.Joint.id }}"
    ></app-analysis-graph> -->
    </mat-expansion-panel>
  </panel-section-collapsible>

  <!-- Forces Arrows-->
  <panel-section
    id='analysis-panel'
    *ngIf="validMechanisms() && this.activeSrv.objType == 'Force'"
  >
    <title-block alwaysShown>
      Analysis for Force {{customIDService.getVisualID(this.activeSrv.selectedForce.id)}}
    </title-block>

    <subtitle-block>
      There are no analysis graphs for forces.
    </subtitle-block>
  </panel-section>

  <!-- Export Button -->
  <!--  <panel-section>-->
  <!--    <button-block icon='download'> Export Analysis for {{ this.activeSrv.objType }} </button-block>-->
  <!--  </panel-section>-->
</div>
